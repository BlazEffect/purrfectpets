# Интернет-магазин PurrfectPets

Добро пожаловать в репозиторий PurrfectPets, это docker для интернет-магазина продажи зоотоваров.

## Содержание

- [Требования](#требования)
- [Технологии](#технологии)
- [Установка](#установка)
- [Запуск](#запуск)

## Требования

- Docker >= 24

## Технологии
- Docker: Используется для настройки виртуальных сред для запуска контейнерных приложений.
- MySQL: База данных
- Nginx: Веб-сервер
- PHP Laravel: Backend веб-фреймворк
- Laravel Sanctum: Внутренний пакет безопасности REST API
- Vue: Frontend фреймворк для создания прогрессивных веб-приложений

## Установка

### Установка Docker

Посетите сайт https://docs.docker.com/get-docker для получения инструкций.

### Установите Docker Compose (только для Linux)

Посетите сайт https://docs.docker.com/compose/install для получения инструкций.

### Переключиться на контейнеры Linux (только для Windows)

Щелкните правой кнопкой мыши на значке Docker на панели задач и выберите "Переключиться на контейнеры Linux..."

### Подготовьте репозитории

1. Клонировать репозиторий docker, backend, frontend:

    ```bash
    git clone --branch=docker https://github.com/BlazEffect/purrfectpets.git docker
    ```

   ```bash
    git clone --branch=backend https://github.com/BlazEffect/purrfectpets.git backend
    ```

   ```bash
    git clone --branch=frontend https://github.com/BlazEffect/purrfectpets.git frontend
    ```

### Подготовьте backend папку

Серверной части требуются разрешения для записи в папки "storage" и "bootstrap/cache".

**Linux/macOS:**
```bash
sudo chmod -R ag+w <путь к серверной папке>/bootstrap/cache
```

```bash
sudo chmod -R ag+w <путь к серверной папке>/storage
```
**Windows:**
Используйте проводник, чтобы изменить права доступа к этим папкам.


### Настройте "docker-compose"

В папке репозитория Docker скопируйте ".env.example" в ".env" и отредактируйте его соответствующим образом:

```bash
cp .env.example .env
 ```

* `COMPOSE_CONVERT_WINDOWS_PATHS=1`   
  Раскомментируйте эту строку в операционной системе Windows. Это позволит Docker преобразовать пути unix/win между собой.
* `DATA_BASE_NAME`   
   Название базы данных
* `DATA_BASE_PASSWORD`   
   Пароль к пользователю базы-данных
* `NAME`  
   Имя, которое будет добавляться к контейнерам Docker
* `PHP_VERSION`   
   Версия PHP, которая будет использоваться на проекте
* `BACKEND_DIR`  
  Абсолютный или относительный путь к папке с клонированным backend репозиторием.
* `FRONTEND_DIR`   
  Абсолютный или относительный путь к папке с клонированным frontend репозиторием.
* `LISTEN_IP`   
IP-адрес для прослушивания входящих HTTP-соединений. Если у вас уже есть "apache"/ "nginx", прослушивающий порт "127.0.0.1:80", вы можете привязать контейнеры docker к другому IP-адресу (по умолчанию "127.0.0.2`).
  ** Внимание:** Если на вашем хостинге уже работают `apache`/`nginx`, убедитесь, что они не привязаны к `0.0.0.0`, это предотвратит запуск контейнера `nginx`. Вместо этого повторно привяжите ваш хост "apache"/"nginx" к "127.0.0.1`.
  ** Пользователи macOS:** По умолчанию macOS не привязывает другие версии 127.0.0.* к адаптеру обратной связи, поэтому вам придется сделать это самостоятельно:
  ``sudo ifconfig lo0 alias 127.0.0.2 up``

**Только для macOS** / **Windows**:
Вы должны разрешить docker engine привязывать и монтировать ваши папки внешнего frontend/backend части в контейнеры:
1. Откройте настройки Docker Agent
2. Выберите **Ресурсы** &rarr; **Общий доступ к файлам** в левом меню.
3. Добавьте папку, в которую вы клонировали репозитории (`/purrfectpets` из предыдущих примеров).

## Запуск

### Настройка хостов

Контейнеры Docker настроены для работы с "purrfectpets.local" (внешний интерфейс) и "api.purrfectpets.local" (внутренний интерфейс).
Вы должны добавить эти записи в свой "/etc/hosts" (linux/macos) или "%WIN_DIR%\System32\drivers\etc\hosts` (win).
```
127.0.0.2 purrfectpets.local
127.0.0.2 api.purrfectpets.local
```
Для редактирования этого файла вам потребуются права суперпользователя/администратора.

### Сборка и запуск контейнеров

Откройте терминал/консоль в папке с клонированным репозиторием Docker и запустите:
```bash
docker docker-compose
```
Сборка может занять некоторое время, поскольку Docker извлекает все необходимые образы из Docker Hub.

Когда все будет готово, вы будете готовы к запуску контейнеров:
```bash
docker docker-compose -d
```

Для запуска/остановки контейнеров вы можете использовать "docker-compose stop" и "docker-compose start".   
Для удаления контейнеров вы можете использовать "docker-compose down".   
Чтобы показать статус контейнеров, вы можете использовать `docker-compose ps`